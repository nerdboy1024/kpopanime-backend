<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>War Room - K-pop Anime Shop Admin</title>

    <!-- Admin Styles -->
    <link rel="stylesheet" href="/admin/admin.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Quill WYSIWYG Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../public/images/favicon.png">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <div class="war-room-icon">‚öîÔ∏è</div>
                <h1>War Room</h1>
                <p>K-pop Anime Shop Administration</p>
            </div>

            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input
                        type="email"
                        id="loginEmail"
                        class="form-input"
                        placeholder="admin@kpopanimeshop.com"
                        required
                        autocomplete="email"
                    >
                </div>

                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input
                        type="password"
                        id="loginPassword"
                        class="form-input"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        required
                        autocomplete="current-password"
                    >
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    <span class="btn-text">Enter War Room</span>
                    <span class="btn-loading" style="display: none;">
                        <span class="spinner"></span>
                        Authenticating...
                    </span>
                </button>

                <div id="loginError" class="error-message" style="display: none;"></div>
            </form>

            <div class="login-footer">
                <p>Protected by Firebase Authentication</p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="admin-dashboard" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">‚öîÔ∏è</span>
                    <span class="logo-text">War Room</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-section="dashboard">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#products" class="nav-item" data-section="products">
                    <span class="nav-icon">üîÆ</span>
                    <span class="nav-text">Products</span>
                </a>
                <a href="#blog" class="nav-item" data-section="blog">
                    <span class="nav-icon">üìù</span>
                    <span class="nav-text">Blog Posts</span>
                </a>
                <a href="#categories" class="nav-item" data-section="categories">
                    <span class="nav-icon">üè∑Ô∏è</span>
                    <span class="nav-text">Categories</span>
                </a>
                <a href="#orders" class="nav-item" data-section="orders">
                    <span class="nav-icon">üì¶</span>
                    <span class="nav-text">Orders</span>
                    <span class="nav-badge" id="ordersBadge" style="display: none;">0</span>
                </a>
                <a href="#users" class="nav-item" data-section="users">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Users</span>
                </a>
                <a href="#segments" class="nav-item" data-section="segments">
                    <span class="nav-icon">üéØ</span>
                    <span class="nav-text">Segments</span>
                </a>
                <a href="#media" class="nav-item" data-section="media">
                    <span class="nav-icon">üñºÔ∏è</span>
                    <span class="nav-text">Media Library</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">üë§</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Admin</div>
                        <div class="user-email" id="userEmail"></div>
                    </div>
                </div>
                <button id="logoutBtn" class="btn-logout">
                    <span>üö™</span> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="header-actions">
                    <button id="headerActionBtn" class="btn btn-primary" style="display: none;">
                        <span id="headerActionText">+ Add New</span>
                    </button>
                </div>
            </div>

            <div class="content-body">
                <!-- Dashboard Section -->
                <section id="dashboardSection" class="content-section active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üîÆ</div>
                            <div class="stat-details">
                                <div class="stat-value" id="statProducts">0</div>
                                <div class="stat-label">Total Products</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">üìù</div>
                            <div class="stat-details">
                                <div class="stat-value" id="statPosts">0</div>
                                <div class="stat-label">Blog Posts</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">üì¶</div>
                            <div class="stat-details">
                                <div class="stat-value" id="statOrders">0</div>
                                <div class="stat-label">Total Orders</div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-details">
                                <div class="stat-value" id="statRevenue">$0</div>
                                <div class="stat-label">Revenue</div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3>Recent Orders</h3>
                            <div id="recentOrders" class="recent-orders-list">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <h3>Low Stock Alert</h3>
                            <div id="lowStock" class="low-stock-list">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Products Section -->
                <section id="productsSection" class="content-section">
                    <div id="productsTable">
                        <!-- Populated by JS -->
                    </div>
                </section>

                <!-- Blog Section -->
                <section id="blogSection" class="content-section">
                    <div id="blogTable">
                        <!-- Populated by JS -->
                    </div>
                </section>

                <!-- Categories Section -->
                <section id="categoriesSection" class="content-section">
                    <div id="categoriesTable">
                        <!-- Populated by JS -->
                    </div>
                </section>

                <!-- Orders Section -->
                <section id="ordersSection" class="content-section">
                    <div id="ordersTable">
                        <!-- Populated by JS -->
                    </div>
                </section>

                <!-- Users Section -->
                <section id="usersSection" class="content-section">
                    <div class="section-toolbar">
                        <div class="toolbar-left">
                            <select id="userRoleFilter" class="form-select">
                                <option value="all">All Roles</option>
                                <option value="admin">Admin</option>
                                <option value="customer">Customer</option>
                                <option value="contributor">Contributor</option>
                                <option value="affiliate">Affiliate</option>
                            </select>
                            <select id="userOptInFilter" class="form-select">
                                <option value="all">All Users</option>
                                <option value="email">Email Opted In</option>
                                <option value="sms">SMS Opted In</option>
                            </select>
                        </div>
                        <div class="toolbar-right">
                            <input type="text" id="userSearch" class="form-input" placeholder="Search users...">
                        </div>
                    </div>
                    <div id="usersTable">
                        <!-- Populated by JS -->
                    </div>
                </section>

                <!-- Segments Section -->
                <section id="segmentsSection" class="content-section">
                    <div class="segments-grid" id="segmentsGrid">
                        <!-- Populated by JS -->
                    </div>
                </section>

                <!-- Media Library Section -->
                <section id="mediaSection" class="content-section">
                    <div id="mediaGrid">
                        <!-- Populated by JS -->
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="productModalTitle">Add Product</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <input type="hidden" id="productId">

                    <div class="form-grid">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="productName">Product Name *</label>
                                <input type="text" id="productName" class="form-input" required>
                            </div>

                            <div class="form-group">
                                <label for="productSlug">URL Slug *</label>
                                <input type="text" id="productSlug" class="form-input" required>
                                <small>Auto-generated from name, can be customized</small>
                            </div>

                            <div class="form-group">
                                <label for="productCategory">Category *</label>
                                <select id="productCategory" class="form-input" required>
                                    <option value="">Select a category...</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="productPrice">Price ($) *</label>
                                    <input type="number" id="productPrice" class="form-input" step="0.01" min="0" required>
                                </div>

                                <div class="form-group">
                                    <label for="productComparePrice">Compare At Price ($)</label>
                                    <input type="number" id="productComparePrice" class="form-input" step="0.01" min="0">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="productStock">Stock Quantity *</label>
                                <input type="number" id="productStock" class="form-input" min="0" required>
                            </div>

                            <div class="form-group">
                                <label for="productDescription">Description</label>
                                <textarea id="productDescription" class="form-input" rows="6"></textarea>
                            </div>

                            <div class="form-row">
                                <div class="form-group checkbox-group">
                                    <label>
                                        <input type="checkbox" id="productActive" checked>
                                        <span>Active (visible on site)</span>
                                    </label>
                                </div>

                                <div class="form-group checkbox-group">
                                    <label>
                                        <input type="checkbox" id="productFeatured">
                                        <span>Featured Product</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-column">
                            <div class="form-group">
                                <label>Product Images</label>
                                <div class="image-upload-zone" id="productImageUpload">
                                    <div class="upload-icon">üì∏</div>
                                    <p>Drag & drop images here or click to browse</p>
                                    <small>Supports JPG, PNG, WebP (max 5MB each)</small>
                                    <input type="file" id="productImageInput" accept="image/jpeg,image/png,image/webp" multiple style="display: none;">
                                </div>

                                <div id="productImageGallery" class="image-gallery">
                                    <!-- Uploaded images appear here -->
                                </div>

                                <div id="productImageProgress" class="upload-progress" style="display: none;">
                                    <div class="progress-bar">
                                        <div class="progress-fill"></div>
                                    </div>
                                    <div class="progress-text">Uploading...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Cancel</button>
                <button type="submit" form="productForm" class="btn btn-primary">Save Product</button>
            </div>
        </div>
    </div>

    <!-- Blog Post Modal -->
    <div id="blogModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="blogModalTitle">Add Blog Post</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="blogForm">
                    <input type="hidden" id="blogId">

                    <div class="form-group">
                        <label for="blogTitle">Post Title *</label>
                        <input type="text" id="blogTitle" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="blogSlug">URL Slug *</label>
                        <input type="text" id="blogSlug" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="blogExcerpt">Excerpt</label>
                        <textarea id="blogExcerpt" class="form-input" rows="3" maxlength="300"></textarea>
                        <small>Brief summary for blog listings (max 300 characters)</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="blogCategory">Category</label>
                            <input type="text" id="blogCategory" class="form-input" placeholder="e.g. Tarot, Spells, Crystals">
                        </div>

                        <div class="form-group">
                            <label for="blogTags">Tags</label>
                            <input type="text" id="blogTags" class="form-input" placeholder="tag1, tag2, tag3">
                            <small>Comma-separated keywords for SEO</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Content *</label>
                        <div class="editor-wrapper">
                            <div id="blogEditor"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Featured Image</label>
                        <div class="image-upload-zone" id="blogImageUpload">
                            <div class="upload-icon">üì∏</div>
                            <p>Drag & drop featured image here or click to browse</p>
                            <small>Supports JPG, PNG, WebP (max 5MB)</small>
                            <input type="file" id="blogImageInput" accept="image/jpeg,image/png,image/webp" style="display: none;">
                        </div>

                        <div id="blogImageGallery" class="image-gallery">
                            <!-- Featured image appears here -->
                        </div>

                        <div id="blogImageProgress" class="upload-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                            <div class="progress-text">Uploading...</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="blogAuthor">Author</label>
                            <input type="text" id="blogAuthor" class="form-input" value="K-pop Anime Shop">
                        </div>

                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="blogPublished" checked>
                                <span>Published (visible on site)</span>
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Cancel</button>
                <button type="submit" form="blogForm" class="btn btn-primary">Save Post</button>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="categoryModalTitle">Add Category</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="categoryForm">
                    <input type="hidden" id="categoryId">

                    <div class="form-group">
                        <label for="categoryName">Category Name *</label>
                        <input type="text" id="categoryName" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="categorySlug">URL Slug *</label>
                        <input type="text" id="categorySlug" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="categoryDescription">Description</label>
                        <textarea id="categoryDescription" class="form-input" rows="4"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Cancel</button>
                <button type="submit" form="categoryForm" class="btn btn-primary">Save Category</button>
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="orderModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="orderModalTitle">Order Details</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="orderDetails">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Close</button>
            </div>
        </div>
    </div>

    <!-- User Details Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="userModalTitle">User Details</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="userDetails">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="saveUserBtn" class="btn btn-primary">Save Changes</button>
                <button type="button" class="btn btn-secondary modal-close">Close</button>
            </div>
        </div>
    </div>

    <!-- Generic Modal (for dynamic content) -->
    <div id="modal" class="modal"></div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Firebase SDK -->
    <script type="module" src="/firebase-config.js"></script>

    <!-- Quill WYSIWYG Editor -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Browser Image Compression -->
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>

    <!-- Admin Script -->
    <script type="module" src="/admin/admin.js"></script>
    <script type="module" src="/admin/admin-users.js"></script>
</body>
</html>
